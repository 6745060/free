import{g as j}from"./@babel_runtime@7.22.3-042e6b4d.js";import{l as ee}from"./htmlparser2@8.0.2-79084d34.js";import{e as te}from"./escape-string-regexp@4.0.0-348311e6.js";import{i as re}from"./is-plain-object@5.0.0-e4f71046.js";import{c as se}from"./deepmerge@4.3.1-89e33937.js";import{p as ie}from"./parse-srcset@1.0.2-e00fb2aa.js";import{p as le}from"./postcss@8.4.24-3e70eac5.js";const ne=ee,V=te,{isPlainObject:ae}=re,q=se,fe=ie,{parse:oe}=le,ce=["img","audio","video","picture","svg","object","map","iframe","embed"],de=["script","style"];function k(c,t){c&&Object.keys(c).forEach(function(w){t(c[w],w)})}function T(c,t){return{}.hasOwnProperty.call(c,t)}function Z(c,t){const w=[];return k(c,function(a){t(a)&&w.push(a)}),w}function ue(c){for(const t in c)if(T(c,t))return!1;return!0}function he(c){return c.map(function(t){if(!t.url)throw new Error("URL missing");return t.url+(t.w?` ${t.w}w`:"")+(t.h?` ${t.h}h`:"")+(t.d?` ${t.d}x`:"")}).join(", ")}var ge=H;const pe=/^[^\0\t\n\f\r /<=>]+$/;function H(c,t,w){if(c==null)return"";typeof c=="number"&&(c=c.toString());let a="",m="";function M(e,s){const r=this;this.tag=e,this.attribs=s||{},this.tagPosition=a.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(u.length){const i=u[u.length-1];i.text+=r.text}},this.updateParentNodeMediaChildren=function(){u.length&&ce.includes(this.tag)&&u[u.length-1].mediaChildren.push(this.tag)}}t=Object.assign({},H.defaults,t),t.parser=Object.assign({},me,t.parser);const N=function(e){return t.allowedTags===!1||(t.allowedTags||[]).indexOf(e)>-1};de.forEach(function(e){N(e)&&!t.allowVulnerableTags&&console.warn(`

⚠️ Your \`allowedTags\` option includes, \`${e}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const X=t.nonTextTags||["script","style","textarea","option"];let d,R;t.allowedAttributes&&(d={},R={},k(t.allowedAttributes,function(e,s){d[s]=[];const r=[];e.forEach(function(i){typeof i=="string"&&i.indexOf("*")>=0?r.push(V(i).replace(/\\\*/g,".*")):d[s].push(i)}),r.length&&(R[s]=new RegExp("^("+r.join("|")+")$"))}));const $={},F={},I={};k(t.allowedClasses,function(e,s){d&&(T(d,s)||(d[s]=[]),d[s].push("class")),$[s]=[],I[s]=[];const r=[];e.forEach(function(i){typeof i=="string"&&i.indexOf("*")>=0?r.push(V(i).replace(/\\\*/g,".*")):i instanceof RegExp?I[s].push(i):$[s].push(i)}),r.length&&(F[s]=new RegExp("^("+r.join("|")+")$"))});const D={};let U;k(t.transformTags,function(e,s){let r;typeof e=="function"?r=e:typeof e=="string"&&(r=H.simpleTransform(e)),s==="*"?U=r:D[s]=r});let g,u,A,C,y,E,P=!1;B();const z=new ne.Parser({onopentag:function(e,s){if(t.enforceHtmlBoundary&&e==="html"&&B(),y){E++;return}const r=new M(e,s);u.push(r);let i=!1;const p=!!r.text;let h;if(T(D,e)&&(h=D[e](e,s),r.attribs=s=h.attribs,h.text!==void 0&&(r.innerText=h.text),e!==h.tagName&&(r.name=e=h.tagName,C[g]=h.tagName)),U&&(h=U(e,s),r.attribs=s=h.attribs,e!==h.tagName&&(r.name=e=h.tagName,C[g]=h.tagName)),(!N(e)||t.disallowedTagsMode==="recursiveEscape"&&!ue(A)||t.nestingLimit!=null&&g>=t.nestingLimit)&&(i=!0,A[g]=!0,t.disallowedTagsMode==="discard"&&X.indexOf(e)!==-1&&(y=!0,E=1),A[g]=!0),g++,i){if(t.disallowedTagsMode==="discard")return;m=a,a=""}a+="<"+e,e==="script"&&(t.allowedScriptHostnames||t.allowedScriptDomains)&&(r.innerText=""),(!d||T(d,e)||d["*"])&&k(s,function(o,f){if(!pe.test(f)){delete r.attribs[f];return}let v=!1;if(!d||T(d,e)&&d[e].indexOf(f)!==-1||d["*"]&&d["*"].indexOf(f)!==-1||T(R,e)&&R[e].test(f)||R["*"]&&R["*"].test(f))v=!0;else if(d&&d[e]){for(const l of d[e])if(ae(l)&&l.name&&l.name===f){v=!0;let n="";if(l.multiple===!0){const S=o.split(" ");for(const b of S)l.values.indexOf(b)!==-1&&(n===""?n=b:n+=" "+b)}else l.values.indexOf(o)>=0&&(n=o);o=n}}if(v){if(t.allowedSchemesAppliedToAttributes.indexOf(f)!==-1&&L(e,o)){delete r.attribs[f];return}if(e==="script"&&f==="src"){let l=!0;try{const n=_(o);if(t.allowedScriptHostnames||t.allowedScriptDomains){const S=(t.allowedScriptHostnames||[]).find(function(x){return x===n.url.hostname}),b=(t.allowedScriptDomains||[]).find(function(x){return n.url.hostname===x||n.url.hostname.endsWith(`.${x}`)});l=S||b}}catch{l=!1}if(!l){delete r.attribs[f];return}}if(e==="iframe"&&f==="src"){let l=!0;try{const n=_(o);if(n.isRelativeUrl)l=T(t,"allowIframeRelativeUrls")?t.allowIframeRelativeUrls:!t.allowedIframeHostnames&&!t.allowedIframeDomains;else if(t.allowedIframeHostnames||t.allowedIframeDomains){const S=(t.allowedIframeHostnames||[]).find(function(x){return x===n.url.hostname}),b=(t.allowedIframeDomains||[]).find(function(x){return n.url.hostname===x||n.url.hostname.endsWith(`.${x}`)});l=S||b}}catch{l=!1}if(!l){delete r.attribs[f];return}}if(f==="srcset")try{let l=fe(o);if(l.forEach(function(n){L("srcset",n.url)&&(n.evil=!0)}),l=Z(l,function(n){return!n.evil}),l.length)o=he(Z(l,function(n){return!n.evil})),r.attribs[f]=o;else{delete r.attribs[f];return}}catch{delete r.attribs[f];return}if(f==="class"){const l=$[e],n=$["*"],S=F[e],b=I[e],x=F["*"],W=[S,x].concat(b).filter(function(Q){return Q});if(l&&n?o=G(o,q(l,n),W):o=G(o,l||n,W),!o.length){delete r.attribs[f];return}}if(f==="style"){if(t.parseStyleAttributes)try{const l=oe(e+" {"+o+"}"),n=Y(l,t.allowedStyles);if(o=J(n),o.length===0){delete r.attribs[f];return}}catch{console.warn('Failed to parse "'+e+" {"+o+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete r.attribs[f];return}else if(t.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}a+=" "+f,o&&o.length&&(a+='="'+O(o,!0)+'"')}else delete r.attribs[f]}),t.selfClosing.indexOf(e)!==-1?a+=" />":(a+=">",r.innerText&&!p&&!t.textFilter&&(a+=O(r.innerText),P=!0)),i&&(a=m+O(a),m="")},ontext:function(e){if(y)return;const s=u[u.length-1];let r;if(s&&(r=s.tag,e=s.innerText!==void 0?s.innerText:e),t.disallowedTagsMode==="discard"&&(r==="script"||r==="style"))a+=e;else{const i=O(e,!1);t.textFilter&&!P?a+=t.textFilter(i,r):P||(a+=i)}if(u.length){const i=u[u.length-1];i.text+=e}},onclosetag:function(e,s){if(y)if(E--,!E)y=!1;else return;const r=u.pop();if(!r)return;if(r.tag!==e){u.push(r);return}y=t.enforceHtmlBoundary?e==="html":!1,g--;const i=A[g];if(i){if(delete A[g],t.disallowedTagsMode==="discard"){r.updateParentNodeText();return}m=a,a=""}if(C[g]&&(e=C[g],delete C[g]),t.exclusiveFilter&&t.exclusiveFilter(r)){a=a.substr(0,r.tagPosition);return}if(r.updateParentNodeMediaChildren(),r.updateParentNodeText(),t.selfClosing.indexOf(e)!==-1||s&&!N(e)&&["escape","recursiveEscape"].indexOf(t.disallowedTagsMode)>=0){i&&(a=m,m="");return}a+="</"+e+">",i&&(a=m+O(a),m=""),P=!1}},t.parser);return z.write(c),z.end(),a;function B(){a="",g=0,u=[],A={},C={},y=!1,E=0}function O(e,s){return typeof e!="string"&&(e=e+""),t.parser.decodeEntities&&(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s&&(e=e.replace(/"/g,"&quot;"))),e=e.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),s&&(e=e.replace(/"/g,"&quot;")),e}function L(e,s){for(s=s.replace(/[\x00-\x20]+/g,"");;){const p=s.indexOf("<!--");if(p===-1)break;const h=s.indexOf("-->",p+4);if(h===-1)break;s=s.substring(0,p)+s.substring(h+3)}const r=s.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!r)return s.match(/^[/\\]{2}/)?!t.allowProtocolRelative:!1;const i=r[1].toLowerCase();return T(t.allowedSchemesByTag,e)?t.allowedSchemesByTag[e].indexOf(i)===-1:!t.allowedSchemes||t.allowedSchemes.indexOf(i)===-1}function _(e){if(e=e.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),e.startsWith("relative:"))throw new Error("relative: exploit attempt");let s="relative://relative-site";for(let p=0;p<100;p++)s+=`/${p}`;const r=new URL(e,s);return{isRelativeUrl:r&&r.hostname==="relative-site"&&r.protocol==="relative:",url:r}}function Y(e,s){if(!s)return e;const r=e.nodes[0];let i;return s[r.selector]&&s["*"]?i=q(s[r.selector],s["*"]):i=s[r.selector]||s["*"],i&&(e.nodes[0].nodes=r.nodes.reduce(K(i),[])),e}function J(e){return e.nodes[0].nodes.reduce(function(s,r){return s.push(`${r.prop}:${r.value}${r.important?" !important":""}`),s},[]).join(";")}function K(e){return function(s,r){return T(e,r.prop)&&e[r.prop].some(function(p){return p.test(r.value)})&&s.push(r),s}}function G(e,s,r){return s?(e=e.split(/\s+/),e.filter(function(i){return s.indexOf(i)!==-1||r.some(function(p){return p.test(i)})}).join(" ")):e}}const me={decodeEntities:!0};H.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0};H.simpleTransform=function(c,t,w){return w=w===void 0?!0:w,t=t||{},function(a,m){let M;if(w)for(M in t)m[M]=t[M];else m=t;return{tagName:c,attribs:m}}};const Ae=j(ge);export{Ae as s};
