import{w as W,v as oe}from"./@vue_runtime-dom@3.3.2-7747b59a.js";import{b as le}from"./vue-router@4.2.0_vue@3.3.2-1a885509.js";import{g as ie}from"./slide-verify-code@1.0.0-55d1dc93.js";import{u as re,a as ue,v as f,q as ne,s as D,w as ce,x as de,y as ve,f as fe}from"./index-2b957120.js";import{f as pe,J as me,h as y,k as N,m as ge}from"./naive-ui@2.34.3_vue@3.3.2-cf3752ae.js";import{v as _e}from"./uuid@9.0.0-a960c1f4.js";import{d as z,q as C,b as we,p as he,W as ye,o as m,c as P,m as r,J as p,N as k,a as l,F as A,M as I,K as ke,a3 as be,a4 as xe,I as E}from"./@vue_runtime-core@3.3.2-da3364bd.js";import{r as i,u}from"./@vue_reactivity@3.3.2-ae2838a1.js";import{L as J}from"./@vue_shared@3.3.2-50d8a10d.js";import{_ as Pe}from"./vue3-qrcode@0.0.2_vue@3.3.2-547b044e.js";import"./@iconify_vue@4.1.1_vue@3.3.2-f279cb68.js";import"./pinia@2.1.1_typescript@4.9.5_vue@3.3.2-4b43aa74.js";import"./vue-demi@0.14.4_vue@3.3.2-71ba0ef2.js";import"./crypto-js@4.1.1-7d239ab2.js";import"./@babel_runtime@7.21.5-042e6b4d.js";import"./axios@1.4.0-4a70c6fc.js";import"./@vueuse_core@9.13.0_vue@3.3.2-596ab462.js";import"./@vueuse_shared@9.13.0_vue@3.3.2-e741950b.js";import"./vue-i18n@9.2.2_vue@3.3.2-f6864f94.js";import"./@intlify_shared@9.2.2-6f62a0ce.js";import"./@intlify_core-base@9.2.2-e46b7bcb.js";import"./@intlify_message-compiler@9.2.2-e451351e.js";import"./@intlify_devtools-if@9.2.2-c61c979f.js";import"./element-plus@2.3.4_vue@3.3.2-a565e156.js";import"./lodash-es@4.17.21-811ce8f5.js";import"./@element-plus_icons-vue@2.1.0_vue@3.3.2-9f61c6d4.js";import"./@sxzz_popperjs-es@2.11.7-c75af06c.js";import"./@ctrl_tinycolor@3.6.0-f8748455.js";import"./dayjs@1.11.7-7063ff69.js";import"./async-validator@4.2.5-dee29e8b.js";import"./memoize-one@6.0.0-297ddbcb.js";import"./escape-html@1.0.3-78e42352.js";import"./normalize-wheel-es@1.2.0-ed76fb12.js";import"./@floating-ui_dom@1.2.8-946b0ed0.js";import"./@floating-ui_core@1.2.6-614032f8.js";import"./vooks@0.2.12_vue@3.3.2-a672608a.js";import"./evtd@0.2.4-b614532e.js";import"./katex@0.16.7-aa744d12.js";import"./seemly@0.3.6-5600174a.js";import"./treemate@0.3.11-25c27bff.js";import"./vdirs@0.1.8_vue@3.3.2-4519c5fd.js";import"./vueuc@0.4.51_vue@3.3.2-6941250f.js";import"./@css-render_vue3-ssr@0.15.12_vue@3.3.2-811edb7f.js";import"./@juggle_resize-observer@3.4.0-41516555.js";import"./css-render@0.15.12-57b1a53f.js";import"./@emotion_hash@0.8.0-8a8e73f6.js";import"./date-fns@2.30.0-975a2d8f.js";import"./@css-render_plugin-bem@0.15.12_css-render@0.15.12-9dde7ffe.js";import"./qrcode@1.5.3-b7eb702b.js";import"./encode-utf8@1.0.3-f813de00.js";import"./dijkstrajs@1.0.3-f906a09e.js";const Ce=g=>(be("data-v-fb967802"),g=g(),xe(),g),Se={class:"p-4 space-y-5 min-h-[200px]"},Re={class:"space-y-6"},Me={class:"flex items-center space-x-4"},Ue={class:"flex-1"},Le={class:"flex items-center space-x-4"},Ne={class:"flex-1"},Ie={class:"flex items-center"},Te={key:0,class:"text-center"},Ve={key:0,class:"flex items-center space-x-2.5 w-full"},Ke={class:"flex-grow"},Be={class:"flex items-center space-x-4"},$e={class:"flex-1"},qe={class:"flex items-center space-x-4"},Fe={class:"flex-1"},We={class:"flex-1"},De=Ce(()=>l("span",null,"初次填写邀请码双方都可获取相应奖励",-1)),Ae={class:"flex items-center"},Ee={class:"text-center"},Je=z({__name:"Login",emits:["closeModel"],setup(g,{emit:S}){const U=le(),_=re(),{isMobile:w}=ue(),n=pe(),d=i(0),c=i(!1),e=i({email:"",firstPassword:"",secondPassword:"",token:"",code:"",inviteCode:""}),a=i({token:!0,code:!0,submit:!0}),L=i({token:"机器验证"}),j=C(()=>v.value.register.registerWay==10?"请输入手机号/邮箱":v.value.register.registerWay==30?"请输入登录的手机号":"请输入登录的邮箱"),T=i(null),V=i(null),G=i(null),R=i(null),H=i(null),O=C(()=>{if(e.value.email.length&&!f(e.value.email))return"error"}),K=C(()=>{if(e.value.firstPassword.length>0&&e.value.firstPassword.length<6)return"error"}),Q=C(()=>{if(e.value.secondPassword.length>0&&(e.value.secondPassword.length<6||e.value.firstPassword!==e.value.secondPassword))return"error"}),X=()=>{a.value.token===!1?c.value=!0:(c.value=!1,a.value.submit=!0),e.value.token.length&&(a.value.code=!1)},M=()=>{c.value=!1},Y=()=>{M(),te(),a.value.token=!0,a.value.code=!1,ee(),e.value.token="",L.value.token="重新获取"},Z=()=>{M(),a.value.token=!1,a.value.code=!0,a.value.submit=!0,L.value.token="验证失败，请重新验证"},ee=()=>{d.value=10,setInterval(()=>{d.value>0&&d.value--,a.value.token=!f(e.value.email)||d.value>0},1e3)},v=i({website:"",register:"",point:""}),h=()=>{b.value?a.value.submit=!f(e.value.email)||e.value.firstPassword.length<6:v.value.register.enableVerifyCode?(a.value.token=!f(e.value.email)||d.value>0,a.value.submit=!f(e.value.email)||!e.value.code.length||e.value.firstPassword.length<6||e.value.secondPassword.length<6||e.value.firstPassword!==e.value.secondPassword):(a.value.submit=!f(e.value.email)||e.value.firstPassword.length<6||e.value.secondPassword.length<6||e.value.firstPassword!==e.value.secondPassword,console.log(a.value.submit))},B=()=>{var s,x;if(!f(e.value.email)){(s=T.value)==null||s.focus();return}var o=w?30:40;if(b.value)ne(e.value.email.toLowerCase(),e.value.firstPassword).then(t=>{t.status==="success"?(S("closeModel"),D(t.data.token),_.getUserInfo(),n.success(t.message)):n.error(t.message)});else{if(v.value.register.enableVerifyCode&&!e.value.code.length){(x=R.value)==null||x.focus();return}ce(e.value.email.toLowerCase(),e.value.email.toLowerCase(),o,e.value.code,e.value.firstPassword,e.value.inviteCode).then(t=>{t.status==="success"?(S("closeModel"),D(t.data.token),_.getUserInfo(),n.success(t.message)):n.error(t.message)})}},se=()=>{e.value.token=_e().replace(/-/g,"").toString()},te=async()=>{se(),e.value.email.includes("@")?await de(e.value.email,e.value.token).then(o=>{var s;o.status==="success"?((s=R.value)==null||s.focus(),n.success(o.message)):n.error(o.message)}):await ve(e.value.email).then(o=>{var s;o.status==="success"?((s=R.value)==null||s.focus(),n.success(o.message)):n.error(o.message)})},$=i(!1);async function q(){try{$.value=!0;const{data:o}=await fe();v.value=o}finally{$.value=!1}}we(()=>{q()});const b=i(!0),ae=()=>{b.value=!0},F=()=>{b.value=!1};return he(U,(o,s)=>{q(),o.query.inviteCode&&(F(),e.value.inviteCode=o.query.inviteCode)},{immediate:!0}),(o,s)=>{const x=ye("NText");return m(),P("div",Se,[r(u(me),{"show-icon":!1},{default:p(()=>[k(" 首次注册赠送 "+J(v.value.point.register)+" 积分 ",1)]),_:1}),l("div",Re,[l("div",Me,[l("div",Ue,[r(u(y),{ref_key:"emailRef",ref:T,value:e.value.email,"onUpdate:value":s[0]||(s[0]=t=>e.value.email=t),status:O.value,clearable:"",placeholder:j.value,onKeyup:h},null,8,["value","status","placeholder"])])]),b.value?(m(),P(A,{key:0},[l("div",Le,[l("div",Ne,[r(u(y),{ref_key:"firstPasswordRef",ref:V,value:e.value.firstPassword,"onUpdate:value":s[1]||(s[1]=t=>e.value.firstPassword=t),status:K.value,clearable:"",type:"password",placeholder:"请输入登录密码",onKeyup:h},null,8,["value","status"])])]),l("div",Ie,[r(u(N),{disabled:a.value.submit,block:"",type:"success",onClick:B},{default:p(()=>[k(" 登录 ")]),_:1},8,["disabled"])]),v.value.register.registerWay>0?(m(),P("div",Te,[r(x,{class:"hyperlink",onClick:W(F,["prevent"])},{default:p(()=>[k("前往注册/重置密码")]),_:1},8,["onClick"])])):I("",!0)],64)):(m(),P(A,{key:1},[v.value.register.enableVerifyCode?(m(),P("div",Ve,[l("div",Ke,[r(u(y),{ref_key:"codeRef",ref:R,value:e.value.code,"onUpdate:value":s[2]||(s[2]=t=>e.value.code=t),disabled:a.value.code,placeholder:(u(w),"请输入6位验证码"),onKeyup:h},null,8,["value","disabled","placeholder"])]),r(u(N),{class:"flex-shrink-0",disabled:a.value.token,type:c.value?"warning":"primary",onClick:s[3]||(s[3]=t=>c.value?M():X())},{default:p(()=>[k(J(c.value?"取消":`${L.value.token}${d.value>0?`(${d.value}s)`:""}`),1)]),_:1},8,["disabled","type"]),r(u(ie),{show:c.value,onClose:M,onFail:Z,onSuccess:Y},null,8,["show"])])):I("",!0),l("div",Be,[l("div",$e,[r(u(y),{ref_key:"firstPasswordRef",ref:V,value:e.value.firstPassword,"onUpdate:value":s[4]||(s[4]=t=>e.value.firstPassword=t),status:K.value,clearable:"",type:"password",placeholder:"请输入登录密码 (6位长度以上)",onKeyup:h},null,8,["value","status"])])]),l("div",qe,[l("div",Fe,[r(u(y),{ref_key:"secondPasswordRef",ref:G,value:e.value.secondPassword,"onUpdate:value":s[5]||(s[5]=t=>e.value.secondPassword=t),status:Q.value,clearable:"",type:"password",placeholder:"请确认登录密码",onKeyup:h},null,8,["value","status"])])]),ke(l("div",We,[r(u(y),{ref_key:"inviteCodeRef",ref:H,value:e.value.inviteCode,"onUpdate:value":s[6]||(s[6]=t=>e.value.inviteCode=t),placeholder:"邀请码",onKeyup:h},null,8,["value"]),De],512),[[oe,!1]]),l("div",Ae,[r(u(N),{disabled:a.value.submit,block:"",type:"success",onClick:B},{default:p(()=>[k(" 注册/重置密码 ")]),_:1},8,["disabled"])]),l("div",Ee,[r(x,{class:"hyperlink",onClick:W(ae,["prevent"])},{default:p(()=>[k("前往登录")]),_:1},8,["onClick"])])],64))])])}}});const ze=Pe(Je,[["__scopeId","data-v-fb967802"]]),Es=z({__name:"index",props:{visible:{type:Boolean}},emits:["update:visible"],setup(g,{emit:S}){const U=g,_=i(!1),w=C({get(){return U.visible},set(c){S("update:visible",c)}});function n(){_.value=!0,setTimeout(()=>{_.value=!1},0)}function d(){setTimeout(()=>{w.value=!1},1e3)}return(c,e)=>(m(),E(u(ge),{show:w.value,"onUpdate:show":e[0]||(e[0]=a=>w.value=a),"auto-focus":!1,closable:!1,"mask-closable":!1,"close-on-esc":!1,preset:"dialog",title:"用户认证",class:"min-w-[100px]:","z-index":100},{default:p(()=>[_.value?I("",!0):(m(),E(ze,{key:0,onUpdate:n,onCloseModel:d}))]),_:1},8,["show"]))}});export{Es as default};
