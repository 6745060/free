import{w as D,v as ae}from"./@vue_runtime-dom@3.2.47-55055d56.js";import{b as le}from"./vue-router@4.1.6_vue@3.2.47-0c8af408.js";import{g as ie}from"./slide-verify-code@1.0.0-145dee99.js";import{v as p}from"./index-abebb590.js";import{u as re,a as ue,o as ne,s as W,p as ce,q as de,v as ve,w as fe}from"./index-5c74c35f.js";import{f as pe,J as me,h as y,k as N,m as ge}from"./naive-ui@2.34.3_vue@3.2.47-2f25bd7d.js";import{v as _e}from"./uuid@9.0.0-a960c1f4.js";import{d as z,p as C,b as we,n as he,V as ye,o as g,c as P,l as u,I as m,M as k,a as i,F as A,L as V,J as ke,a1 as be,a2 as xe,H as E}from"./@vue_runtime-core@3.2.47-ee5b5de5.js";import{r,u as a,i as Pe}from"./@vue_reactivity@3.2.47-860f2346.js";import{L as J}from"./@vue_shared@3.2.47-c78728cc.js";import{_ as Ce}from"./vue3-qrcode@0.0.2_vue@3.2.47-434b0ed2.js";import"./@iconify_vue@4.1.1_vue@3.2.47-b9acde6e.js";import"./pinia@2.0.36_hmuptsblhheur2tugfgucj7gc4-583fa057.js";import"./vue-demi@0.14.1_vue@3.2.47-71ba0ef2.js";import"./crypto-js@4.1.1-7d239ab2.js";import"./@babel_runtime@7.21.5-042e6b4d.js";import"./axios@1.4.0-4a70c6fc.js";import"./@vueuse_core@9.13.0_vue@3.2.47-e79087a4.js";import"./@vueuse_shared@9.13.0_vue@3.2.47-214f754a.js";import"./vue-i18n@9.2.2_vue@3.2.47-1b2f263e.js";import"./@intlify_shared@9.2.2-6f62a0ce.js";import"./@intlify_core-base@9.2.2-e46b7bcb.js";import"./@intlify_message-compiler@9.2.2-e451351e.js";import"./@intlify_devtools-if@9.2.2-c61c979f.js";import"./element-plus@2.3.4_vue@3.2.47-403cb9d4.js";import"./lodash-es@4.17.21-811ce8f5.js";import"./@element-plus_icons-vue@2.1.0_vue@3.2.47-d31af59d.js";import"./@sxzz_popperjs-es@2.11.7-c75af06c.js";import"./@ctrl_tinycolor@3.6.0-f8748455.js";import"./dayjs@1.11.7-7063ff69.js";import"./@vue_reactivity@3.3.0-beta.5-c1286f32.js";import"./@vue_shared@3.3.0-beta.5-6fb4f07b.js";import"./async-validator@4.2.5-dee29e8b.js";import"./memoize-one@6.0.0-297ddbcb.js";import"./escape-html@1.0.3-78e42352.js";import"./normalize-wheel-es@1.2.0-ed76fb12.js";import"./@floating-ui_dom@1.2.7-56616971.js";import"./@floating-ui_core@1.2.6-614032f8.js";import"./vooks@0.2.12_vue@3.2.47-b8ac7ab6.js";import"./evtd@0.2.4-b614532e.js";import"./katex@0.16.7-aa744d12.js";import"./seemly@0.3.6-5600174a.js";import"./vdirs@0.1.8_vue@3.2.47-4519c5fd.js";import"./treemate@0.3.11-25c27bff.js";import"./vueuc@0.4.51_vue@3.2.47-8f25ae16.js";import"./@css-render_vue3-ssr@0.15.12_vue@3.2.47-3117f20a.js";import"./@juggle_resize-observer@3.4.0-41516555.js";import"./css-render@0.15.12-57b1a53f.js";import"./@emotion_hash@0.8.0-8a8e73f6.js";import"./date-fns@2.30.0-975a2d8f.js";import"./@css-render_plugin-bem@0.15.12_css-render@0.15.12-9dde7ffe.js";import"./qrcode@1.5.3-a7ae4534.js";import"./encode-utf8@1.0.3-f813de00.js";import"./dijkstrajs@1.0.3-f906a09e.js";const Se=_=>(be("data-v-fb967802"),_=_(),xe(),_),Re={class:"p-4 space-y-5 min-h-[200px]"},Me={class:"space-y-6"},Ue={class:"flex items-center space-x-4"},Le={class:"flex-1"},Ne={class:"flex items-center space-x-4"},Ve={class:"flex-1"},Ie={class:"flex items-center"},Te={key:0,class:"text-center"},Be={key:0,class:"flex items-center space-x-2.5 w-full"},Ke={class:"flex-grow"},$e={class:"flex items-center space-x-4"},Fe={class:"flex-1"},qe={class:"flex items-center space-x-4"},De={class:"flex-1"},We={class:"flex-1"},Ae=Se(()=>i("span",null,"初次填写邀请码双方都可获取相应奖励",-1)),Ee={class:"flex items-center"},Je={class:"text-center"},ze=z({__name:"Login",emits:["closeModel"],setup(_,{emit:S}){const U=le(),w=re(),{isMobile:f}=ue(),n=pe(),d=r(0),c=r(!1),e=r({email:"",firstPassword:"",secondPassword:"",token:"",code:"",inviteCode:""}),o=r({token:!0,code:!0,submit:!0}),L=r({token:"机器验证"}),H=C(()=>v.value.register.registerWay==10?"请输入手机号/邮箱":v.value.register.registerWay==30?"请输入登录的手机号":"请输入登录的邮箱"),I=r(null),T=r(null),j=r(null),R=r(null),G=r(null),O=C(()=>{if(e.value.email.length&&!p(e.value.email))return"error"}),B=C(()=>{if(e.value.firstPassword.length>0&&e.value.firstPassword.length<6)return"error"}),Q=C(()=>{if(e.value.secondPassword.length>0&&(e.value.secondPassword.length<6||e.value.firstPassword!==e.value.secondPassword))return"error"}),X=()=>{o.value.token===!1?c.value=!0:(c.value=!1,o.value.submit=!0),e.value.token.length&&(o.value.code=!1)},M=()=>{c.value=!1},Y=()=>{M(),te(),o.value.token=!0,o.value.code=!1,ee(),e.value.token="",L.value.token="重新获取"},Z=()=>{M(),o.value.token=!1,o.value.code=!0,o.value.submit=!0,L.value.token="验证失败，请重新验证"},ee=()=>{d.value=10,setInterval(()=>{d.value>0&&d.value--,o.value.token=!p(e.value.email)||d.value>0},1e3)},v=r({website:"",register:"",point:""}),h=()=>{b.value?o.value.submit=!p(e.value.email)||e.value.firstPassword.length<6:v.value.register.enableVerifyCode?(o.value.token=!p(e.value.email)||d.value>0,o.value.submit=!p(e.value.email)||!e.value.code.length||e.value.firstPassword.length<6||e.value.secondPassword.length<6||e.value.firstPassword!==e.value.secondPassword):(o.value.submit=!p(e.value.email)||e.value.firstPassword.length<6||e.value.secondPassword.length<6||e.value.firstPassword!==e.value.secondPassword,console.log(o.value.submit))},K=()=>{var s,x;if(!p(e.value.email)){(s=I.value)==null||s.focus();return}var l=f?30:40;if(b.value)ne(e.value.email.toLowerCase(),e.value.firstPassword).then(t=>{t.status==="success"?(S("closeModel"),W(t.data.token),w.getUserInfo(),n.success(t.message)):n.error(t.message)});else{if(v.value.register.enableVerifyCode&&!e.value.code.length){(x=R.value)==null||x.focus();return}ce(e.value.email.toLowerCase(),e.value.email.toLowerCase(),l,e.value.code,e.value.firstPassword,e.value.inviteCode).then(t=>{t.status==="success"?(S("closeModel"),W(t.data.token),w.getUserInfo(),n.success(t.message)):n.error(t.message)})}},se=()=>{e.value.token=_e().replace(/-/g,"").toString()},te=async()=>{se(),e.value.email.includes("@")?await de(e.value.email,e.value.token).then(l=>{var s;l.status==="success"?((s=R.value)==null||s.focus(),n.success(l.message)):n.error(l.message)}):await ve(e.value.email).then(l=>{var s;l.status==="success"?((s=R.value)==null||s.focus(),n.success(l.message)):n.error(l.message)})},$=r(!1);async function F(){try{$.value=!0;const{data:l}=await fe();v.value=l}finally{$.value=!1}}we(()=>{F()});const b=r(!0),oe=()=>{b.value=!0},q=()=>{b.value=!1};return he(U,(l,s)=>{F(),l.query.inviteCode&&(q(),e.value.inviteCode=l.query.inviteCode)},{immediate:!0}),(l,s)=>{const x=ye("NText");return g(),P("div",Re,[u(a(me),{"show-icon":!1},{default:m(()=>[k(" 首次注册赠送 "+J(v.value.point.register)+" 积分 ",1)]),_:1}),i("div",Me,[i("div",Ue,[i("div",Le,[u(a(y),{ref_key:"emailRef",ref:I,value:e.value.email,"onUpdate:value":s[0]||(s[0]=t=>e.value.email=t),status:a(O),clearable:"",placeholder:a(H),onKeyup:h},null,8,["value","status","placeholder"])])]),b.value?(g(),P(A,{key:0},[i("div",Ne,[i("div",Ve,[u(a(y),{ref_key:"firstPasswordRef",ref:T,value:e.value.firstPassword,"onUpdate:value":s[1]||(s[1]=t=>e.value.firstPassword=t),status:a(B),clearable:"",type:"password",placeholder:"请输入登录密码",onKeyup:h},null,8,["value","status"])])]),i("div",Ie,[u(a(N),{disabled:o.value.submit,block:"",type:"success",onClick:K},{default:m(()=>[k(" 登录 ")]),_:1},8,["disabled"])]),v.value.register.registerWay>0?(g(),P("div",Te,[u(x,{class:"hyperlink",onClick:D(q,["prevent"])},{default:m(()=>[k("前往注册/重置密码")]),_:1},8,["onClick"])])):V("",!0)],64)):(g(),P(A,{key:1},[v.value.register.enableVerifyCode?(g(),P("div",Be,[i("div",Ke,[u(a(y),{ref_key:"codeRef",ref:R,value:e.value.code,"onUpdate:value":s[2]||(s[2]=t=>e.value.code=t),disabled:o.value.code,placeholder:(a(f),"请输入6位验证码"),onKeyup:h},null,8,["value","disabled","placeholder"])]),u(a(N),{class:"flex-shrink-0",disabled:o.value.token,type:c.value?"warning":"primary",onClick:s[3]||(s[3]=t=>c.value?M():X())},{default:m(()=>[k(J(c.value?"取消":`${L.value.token}${d.value>0?`(${d.value}s)`:""}`),1)]),_:1},8,["disabled","type"]),u(a(ie),{show:c.value,onClose:M,onFail:Z,onSuccess:Y},null,8,["show"])])):V("",!0),i("div",$e,[i("div",Fe,[u(a(y),{ref_key:"firstPasswordRef",ref:T,value:e.value.firstPassword,"onUpdate:value":s[4]||(s[4]=t=>e.value.firstPassword=t),status:a(B),clearable:"",type:"password",placeholder:"请输入登录密码 (6位长度以上)",onKeyup:h},null,8,["value","status"])])]),i("div",qe,[i("div",De,[u(a(y),{ref_key:"secondPasswordRef",ref:j,value:e.value.secondPassword,"onUpdate:value":s[5]||(s[5]=t=>e.value.secondPassword=t),status:a(Q),clearable:"",type:"password",placeholder:"请确认登录密码",onKeyup:h},null,8,["value","status"])])]),ke(i("div",We,[u(a(y),{ref_key:"inviteCodeRef",ref:G,value:e.value.inviteCode,"onUpdate:value":s[6]||(s[6]=t=>e.value.inviteCode=t),placeholder:"邀请码",onKeyup:h},null,8,["value"]),Ae],512),[[ae,!1]]),i("div",Ee,[u(a(N),{disabled:o.value.submit,block:"",type:"success",onClick:K},{default:m(()=>[k(" 注册/重置密码 ")]),_:1},8,["disabled"])]),i("div",Je,[u(x,{class:"hyperlink",onClick:D(oe,["prevent"])},{default:m(()=>[k("前往登录")]),_:1},8,["onClick"])])],64))])])}}});const He=Ce(ze,[["__scopeId","data-v-fb967802"]]),js=z({__name:"index",props:{visible:{type:Boolean}},emits:["update:visible"],setup(_,{emit:S}){const U=_,w=r(!1),f=C({get(){return U.visible},set(c){S("update:visible",c)}});function n(){w.value=!0,setTimeout(()=>{w.value=!1},0)}function d(){setTimeout(()=>{f.value=!1},1e3)}return(c,e)=>(g(),E(a(ge),{show:a(f),"onUpdate:show":e[0]||(e[0]=o=>Pe(f)?f.value=o:null),"auto-focus":!1,closable:!1,"mask-closable":!1,"close-on-esc":!1,preset:"dialog",title:"用户认证",class:"min-w-[100px]:","z-index":100},{default:m(()=>[w.value?V("",!0):(g(),E(He,{key:0,onUpdate:n,onCloseModel:d}))]),_:1},8,["show"]))}});export{js as default};
